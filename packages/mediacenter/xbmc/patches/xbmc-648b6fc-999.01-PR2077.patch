From 52dac5c61cc4dc97ca74aa8398589bc1dfc25a1e Mon Sep 17 00:00:00 2001
From: John Rennie <john.rennie@ratsauce.co.uk>
Date: Tue, 15 Jan 2013 10:27:00 +0000
Subject: [PATCH 1/4] Add key mapping for the power button

---
 system/keymaps/keyboard.xml |    1 +
 1 file changed, 1 insertion(+)

diff --git a/system/keymaps/keyboard.xml b/system/keymaps/keyboard.xml
index 4271157..d8b6f47 100644
--- a/system/keymaps/keyboard.xml
+++ b/system/keymaps/keyboard.xml
@@ -94,6 +94,7 @@
       <backslash>ToggleFullScreen</backslash>
       <home>FirstPage</home>
       <end>LastPage</end>
+      <power>XBMC.ShutDown()</power>
       <!-- PVR windows -->
       <e>XBMC.ActivateWindowAndFocus(MyPVR, 31,0, 10,0)</e>
       <h>XBMC.ActivateWindowAndFocus(MyPVR, 32,0, 11,0)</h>
-- 
1.7.10


From 169be40560488d0e6ca9548dc694e7ca0005288e Mon Sep 17 00:00:00 2001
From: John Rennie <john.rennie@ratsauce.co.uk>
Date: Tue, 15 Jan 2013 12:13:19 +0000
Subject: [PATCH 2/4] Add support for sleep key in Linux

---
 xbmc/input/XBMC_keysym.h        |    1 +
 xbmc/input/XBMC_keytable.cpp    |    1 +
 xbmc/input/XBMC_vkeys.h         |    1 +
 xbmc/windowing/WinEventsSDL.cpp |    2 +-
 4 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/xbmc/input/XBMC_keysym.h b/xbmc/input/XBMC_keysym.h
index 0d8ba07..20d12b3 100644
--- a/xbmc/input/XBMC_keysym.h
+++ b/xbmc/input/XBMC_keysym.h
@@ -214,6 +214,7 @@
   XBMCK_POWER       = 0x140,    // Power Macintosh power key
   XBMCK_EURO        = 0x141,    // Some european keyboards
   XBMCK_UNDO        = 0x142,    // Atari keyboard has Undo
+  XBMCK_SLEEP       = 0x143,    // Sleep button on Nyxboard remote (and others?)
 
   // Add any other keys here
 
diff --git a/xbmc/input/XBMC_keytable.cpp b/xbmc/input/XBMC_keytable.cpp
index dbc28a7..aaf65ba 100644
--- a/xbmc/input/XBMC_keytable.cpp
+++ b/xbmc/input/XBMC_keytable.cpp
@@ -222,6 +222,7 @@
 , { XBMCK_SCROLLOCK,              0,    0, XBMCVK_SCROLLLOCK,    "scrolllock" }
 , { XBMCK_PRINT,                  0,    0, XBMCVK_PRINTSCREEN,   "printscreen" }
 , { XBMCK_POWER,                  0,    0, XBMCVK_POWER,         "power" }
+, { XBMCK_SLEEP,                  0,    0, XBMCVK_SLEEP,         "sleep" }
 };
 
 static int XBMCKeyTableSize = sizeof(XBMCKeyTable)/sizeof(XBMCKEYTABLE);
diff --git a/xbmc/input/XBMC_vkeys.h b/xbmc/input/XBMC_vkeys.h
index 38f675d..70b27e3 100644
--- a/xbmc/input/XBMC_vkeys.h
+++ b/xbmc/input/XBMC_vkeys.h
@@ -205,6 +205,7 @@
   XBMCVK_SCROLLLOCK     = 0xDC,
   XBMCVK_PAUSE          = 0XDD,
   XBMCVK_POWER          = 0XDE,
+  XBMCVK_SLEEP          = 0XDF,
 
   XBMCVK_LAST           = 0xFF
 } XBMCVKey;
diff --git a/xbmc/windowing/WinEventsSDL.cpp b/xbmc/windowing/WinEventsSDL.cpp
index 0acf810..c3c385f 100644
--- a/xbmc/windowing/WinEventsSDL.cpp
+++ b/xbmc/windowing/WinEventsSDL.cpp
@@ -69,7 +69,7 @@
 , { 138, 0x69 /* 'i' */}             // Info
 , { 147, 0x6d /* 'm' */}             // Menu
 , { 148, XBMCK_LAUNCH_APP2 }         // Launch app 2
-, { 150, 0x9f }                      // Sleep
+, { 150, XBMCK_SLEEP }               // Sleep
 , { 152, XBMCK_LAUNCH_APP1 }         // Launch app 1
 , { 163, XBMCK_LAUNCH_MAIL }         // Launch Mail
 , { 164, XBMCK_BROWSER_FAVORITES }   // Browser favorites
-- 
1.7.10


From 6d0fe342052140c0153ddf4d253a6376fecc7c49 Mon Sep 17 00:00:00 2001
From: John Rennie <renniej@RatBuntu.(none)>
Date: Tue, 15 Jan 2013 13:12:42 +0000
Subject: [PATCH 3/4] Move the Nyxboard sleep key mapping to the main keymap

---
 system/keymaps/keyboard.xml          |    3 ++-
 system/keymaps/nyxboard/keyboard.xml |    1 -
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/system/keymaps/keyboard.xml b/system/keymaps/keyboard.xml
index d8b6f47..a6431eb 100644
--- a/system/keymaps/keyboard.xml
+++ b/system/keymaps/keyboard.xml
@@ -94,7 +94,8 @@
       <backslash>ToggleFullScreen</backslash>
       <home>FirstPage</home>
       <end>LastPage</end>
-      <power>XBMC.ShutDown()</power>
+      <power>ActivateWindow(shutdownmenu)</power>
+      <sleep>ActivateWindow(shutdownmenu)</sleep>
       <!-- PVR windows -->
       <e>XBMC.ActivateWindowAndFocus(MyPVR, 31,0, 10,0)</e>
       <h>XBMC.ActivateWindowAndFocus(MyPVR, 32,0, 11,0)</h>
diff --git a/system/keymaps/nyxboard/keyboard.xml b/system/keymaps/nyxboard/keyboard.xml
index 41914cb..278ffce 100644
--- a/system/keymaps/nyxboard/keyboard.xml
+++ b/system/keymaps/nyxboard/keyboard.xml
@@ -8,7 +8,6 @@
       <f4 mod="shift">ActivateWindow(music)</f4>    <!-- Green -->
       <f5 mod="shift">ActivateWindow(pictures)</f5> <!-- Yellow -->
       <f6 mod="shift">ActivateWindow(programs)</f6> <!-- Blue -->
-      <key id='61952'>ActivateWindow(shutdownmenu)</key> <!-- Power button -->
       <key id='285'>ContextMenu</key>                    <!-- User button -->
     </keyboard>
   </global>
-- 
1.7.10


From 1a7e31fc944adba05e5857272e26e985ae767c3f Mon Sep 17 00:00:00 2001
From: John Rennie <renniej@RatBuntu.(none)>
Date: Tue, 15 Jan 2013 13:19:04 +0000
Subject: [PATCH 4/4] Use key name not id in the Nyxboard mapping for F4

---
 system/keymaps/nyxboard/keyboard.xml |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/system/keymaps/nyxboard/keyboard.xml b/system/keymaps/nyxboard/keyboard.xml
index 278ffce..83e25c2 100644
--- a/system/keymaps/nyxboard/keyboard.xml
+++ b/system/keymaps/nyxboard/keyboard.xml
@@ -8,7 +8,7 @@
       <f4 mod="shift">ActivateWindow(music)</f4>    <!-- Green -->
       <f5 mod="shift">ActivateWindow(pictures)</f5> <!-- Yellow -->
       <f6 mod="shift">ActivateWindow(programs)</f6> <!-- Blue -->
-      <key id='285'>ContextMenu</key>                    <!-- User button -->
+      <f4>ContextMenu</f4>                          <!-- User button -->
     </keyboard>
   </global>
 </keymap>
-- 
1.7.10

