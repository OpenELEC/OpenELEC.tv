diff -uNr ../linux-3.1-rc9/drivers/media/dvb/frontends/Kconfig linux-3.1-rc9//drivers/media/dvb/frontends/Kconfig
--- ../linux-3.1-rc9/drivers/media/dvb/frontends/Kconfig	2011-10-05 01:11:50.000000000 +0000
+++ linux-3.1-rc9//drivers/media/dvb/frontends/Kconfig	2011-10-17 16:49:00.844730080 +0000
@@ -213,6 +213,13 @@
 	default m if DVB_FE_CUSTOMISE
 	help
 	  A DVB-S/S2 tuner module. Say Y when you want to support this frontend.
+	  
+config DVB_TBSFE
+	tristate "TBS FE based"
+	depends on DVB_CORE && I2C
+	default m if DVB_FE_CUSTOMISE
+	help
+	  A TurboSight TBS FE module. Say Y when you want to support this.
 
 config DVB_SI21XX
 	tristate "Silicon Labs SI21XX based"
diff -uNr ../linux-3.1-rc9/drivers/media/dvb/frontends/Makefile linux-3.1-rc9//drivers/media/dvb/frontends/Makefile
--- ../linux-3.1-rc9/drivers/media/dvb/frontends/Makefile	2011-10-05 01:11:50.000000000 +0000
+++ linux-3.1-rc9//drivers/media/dvb/frontends/Makefile	2011-10-17 16:49:00.845730067 +0000
@@ -73,6 +73,7 @@
 obj-$(CONFIG_DVB_DUMMY_FE) += dvb_dummy_fe.o
 obj-$(CONFIG_DVB_AF9013) += af9013.o
 obj-$(CONFIG_DVB_CX24116) += cx24116.o
+obj-$(CONFIG_DVB_TBSFE) += tbsfe.o
 obj-$(CONFIG_DVB_SI21XX) += si21xx.o
 obj-$(CONFIG_DVB_STV0288) += stv0288.o
 obj-$(CONFIG_DVB_STB6000) += stb6000.o
diff -uNr ../linux-3.1-rc9/drivers/media/dvb/frontends/tbsfe.c linux-3.1-rc9//drivers/media/dvb/frontends/tbsfe.c
--- ../linux-3.1-rc9/drivers/media/dvb/frontends/tbsfe.c	1970-01-01 00:00:00.000000000 +0000
+++ linux-3.1-rc9//drivers/media/dvb/frontends/tbsfe.c	2011-10-17 16:49:00.863729843 +0000
@@ -0,0 +1,55 @@
+/*
+    TurboSight TBS FE module
+    Copyright (C) 2011 Konstantin Dimitrov <kosio.dimitrov@gmail.com>
+
+    Copyright (C) 2011 TurboSight.com
+*/
+
+#include "dvb_frontend.h"
+#include "tbsfe.h"
+
+/* phase poise enhancements */
+static int pne;
+module_param(pne, int, 0644);
+MODULE_PARM_DESC(pne, "Phase noise enhancements 0:Off, "\
+	"1:On (default:0)");
+
+/* define how SNR measurement is reported */
+static int esno;
+module_param(esno, int, 0644);
+MODULE_PARM_DESC(esno, "SNR is reported in 0:Percentage, "\
+	"1:(EsNo dB)*10 (default:0)");
+
+/* define how signal measurement is reported */
+static int dbm;
+module_param(dbm, int, 0644);
+MODULE_PARM_DESC(dbm, "Signal is reported in 0:Percentage, "\
+	"1:-1*dBm (default:0)");
+
+/* define how outer code correction is performed */
+static int occ = 1;
+module_param(occ, int, 0644);
+MODULE_PARM_DESC(occ, "0:outer code correction is disabled, "\
+	"1: outer code correction is enabled(default:1)");
+
+static int tbsfe_params(struct dvb_frontend *fe, long arg)
+{
+	return (occ << 3) | (pne << 2) | (esno << 1) | dbm;
+}
+
+static void tbsfe_release(struct dvb_frontend *fe)
+{
+}
+
+struct dvb_frontend *tbsfe_attach(struct dvb_frontend *fe)
+{
+	fe->ops.release_sec = tbsfe_release;
+	fe->ops.enable_high_lnb_voltage = tbsfe_params;
+
+	return fe;
+}
+EXPORT_SYMBOL(tbsfe_attach);
+
+MODULE_DESCRIPTION("TurboSight TBS FE module");
+MODULE_AUTHOR("Konstantin Dimitrov <kosio.dimitrov@gmail.com>");
+MODULE_LICENSE("GPL");
diff -uNr ../linux-3.1-rc9/drivers/media/dvb/frontends/tbsfe.h linux-3.1-rc9//drivers/media/dvb/frontends/tbsfe.h
--- ../linux-3.1-rc9/drivers/media/dvb/frontends/tbsfe.h	1970-01-01 00:00:00.000000000 +0000
+++ linux-3.1-rc9//drivers/media/dvb/frontends/tbsfe.h	2011-10-17 16:49:00.864729831 +0000
@@ -0,0 +1,27 @@
+/*
+    TurboSight TBS FE module
+    Copyright (C) 2011 Konstantin Dimitrov <kosio.dimitrov@gmail.com>
+
+    Copyright (C) 2011 TurboSight.com
+*/
+
+#ifndef TBSFE_H
+#define TBSFE_H
+
+#include <linux/dvb/frontend.h>
+
+#if defined(CONFIG_DVB_TBSFE) || \
+	(defined(CONFIG_DVB_TBSFE_MODULE) && defined(MODULE))
+extern struct dvb_frontend *tbsfe_attach(
+	struct dvb_frontend *fe);
+#else
+static inline struct dvb_frontend *tbsfe_attach(
+	struct dvb_frontend *fe)
+{
+	printk(KERN_WARNING "%s: driver disabled by Kconfig\n", __func__);
+	return NULL;
+}
+
+#endif /* CONFIG_DVB_TBSFE */
+
+#endif /* TBSFE_H */
diff -uNr ../linux-3.1-rc9/drivers/media/video/cx23885/Kconfig linux-3.1-rc9//drivers/media/video/cx23885/Kconfig
--- ../linux-3.1-rc9/drivers/media/video/cx23885/Kconfig	2011-10-05 01:11:50.000000000 +0000
+++ linux-3.1-rc9//drivers/media/video/cx23885/Kconfig	2011-10-17 16:49:00.865729819 +0000
@@ -23,6 +23,9 @@
 	select DVB_STV0900 if !DVB_FE_CUSTOMISE
 	select DVB_DS3000 if !DVB_FE_CUSTOMISE
 	select DVB_STV0367 if !DVB_FE_CUSTOMISE
+	select DVB_TBS6980FE if !DVB_FE_CUSTOMISE
+	select DVB_TBS6981FE if !DVB_FE_CUSTOMISE
+	select DVB_TBS6921FE if !DVB_FE_CUSTOMISE
 	select MEDIA_TUNER_MT2131 if !MEDIA_TUNER_CUSTOMISE
 	select MEDIA_TUNER_XC2028 if !MEDIA_TUNER_CUSTOMISE
 	select MEDIA_TUNER_TDA8290 if !MEDIA_TUNER_CUSTOMISE
diff -uNr ../linux-3.1-rc9/drivers/media/video/cx23885/cx23885-cards.c linux-3.1-rc9//drivers/media/video/cx23885/cx23885-cards.c
--- ../linux-3.1-rc9/drivers/media/video/cx23885/cx23885-cards.c	2011-10-17 16:57:32.784329949 +0000
+++ linux-3.1-rc9//drivers/media/video/cx23885/cx23885-cards.c	2011-10-17 16:49:00.867729793 +0000
@@ -217,6 +217,20 @@
 		.name		= "TurboSight TBS 6920",
 		.portb		= CX23885_MPEG_DVB,
 	},
+	[CX23885_BOARD_TBS_6921] = {
+		.name		= "TurboSight TBS 6921",
+		.portb		= CX23885_MPEG_DVB,
+	},
+	[CX23885_BOARD_TBS_6980] = {
+		.name		= "TurboSight TBS 6980",
+		.portb		= CX23885_MPEG_DVB,
+		.portc		= CX23885_MPEG_DVB,
+	},
+	[CX23885_BOARD_TBS_6981] = {
+		.name		= "TurboSight TBS 6981",
+		.portb		= CX23885_MPEG_DVB,
+		.portc		= CX23885_MPEG_DVB,
+	},
 	[CX23885_BOARD_TEVII_S470] = {
 		.name		= "TeVii S470",
 		.portb		= CX23885_MPEG_DVB,
@@ -479,6 +493,18 @@
 		.subdevice = 0x8888,
 		.card      = CX23885_BOARD_TBS_6920,
 	}, {
+		.subvendor = 0x6921,
+		.subdevice = 0x8888,
+		.card      = CX23885_BOARD_TBS_6921,
+	}, {
+		.subvendor = 0x6980,
+		.subdevice = 0x8888,
+		.card      = CX23885_BOARD_TBS_6980,
+	}, {
+		.subvendor = 0x6981,
+		.subdevice = 0x8888,
+		.card      = CX23885_BOARD_TBS_6981,
+	}, {
 		.subvendor = 0xd470,
 		.subdevice = 0x9022,
 		.card      = CX23885_BOARD_TEVII_S470,
@@ -965,6 +991,9 @@
 		cx_set(GP0_IO, 0x00040004);
 		break;
 	case CX23885_BOARD_TBS_6920:
+	case CX23885_BOARD_TBS_6921:
+	case CX23885_BOARD_TBS_6980:
+	case CX23885_BOARD_TBS_6981:
 		cx_write(MC417_CTL, 0x00000036);
 		cx_write(MC417_OEN, 0x00001000);
 		cx_set(MC417_RWD, 0x00000002);
@@ -1192,6 +1221,18 @@
 		v4l2_subdev_call(dev->sd_cx25840, core, s_io_pin_config,
 				 ir_rxtx_pin_cfg_count, ir_rxtx_pin_cfg);
 		break;
+	case CX23885_BOARD_TBS_6920:
+	case CX23885_BOARD_TBS_6921:
+	case CX23885_BOARD_TBS_6980:
+	case CX23885_BOARD_TBS_6981:
+		dev->sd_ir = cx23885_find_hw(dev, CX23885_HW_AV_CORE);
+		if (dev->sd_ir == NULL) {
+			ret = -ENODEV;
+			break;
+		}
+		v4l2_subdev_call(dev->sd_cx25840, core, s_io_pin_config,
+				 ir_rx_pin_cfg_count, ir_rx_pin_cfg);
+		break;
 	case CX23885_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL_EXP:
 		request_module("ir-kbd-i2c");
 		break;
@@ -1212,6 +1253,10 @@
 		break;
 	case CX23885_BOARD_TEVII_S470:
 	case CX23885_BOARD_HAUPPAUGE_HVR1250:
+	case CX23885_BOARD_TBS_6920:
+	case CX23885_BOARD_TBS_6921:
+	case CX23885_BOARD_TBS_6980:
+	case CX23885_BOARD_TBS_6981:
 		cx23885_irq_remove(dev, PCI_MSK_AV_CORE);
 		/* sd_ir is a duplicate pointer to the AV Core, just clear it */
 		dev->sd_ir = NULL;
@@ -1255,6 +1300,10 @@
 		break;
 	case CX23885_BOARD_TEVII_S470:
 	case CX23885_BOARD_HAUPPAUGE_HVR1250:
+	case CX23885_BOARD_TBS_6920:
+	case CX23885_BOARD_TBS_6921:
+	case CX23885_BOARD_TBS_6980:
+	case CX23885_BOARD_TBS_6981:
 		if (dev->sd_ir)
 			cx23885_irq_add_enable(dev, PCI_MSK_AV_CORE);
 		break;
@@ -1333,10 +1382,20 @@
 		ts2->src_sel_val   = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;
 		break;
 	case CX23885_BOARD_TBS_6920:
+	case CX23885_BOARD_TBS_6921:
 		ts1->gen_ctrl_val  = 0x4; /* Parallel */
 		ts1->ts_clk_en_val = 0x1; /* Enable TS_CLK */
 		ts1->src_sel_val   = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;
 		break;
+	case CX23885_BOARD_TBS_6980:
+	case CX23885_BOARD_TBS_6981:
+		ts1->gen_ctrl_val  = 0x0c; /* Serial bus + punctured clock */
+		ts1->ts_clk_en_val = 0x1;  /* Enable TS_CLK */
+		ts1->src_sel_val   = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;
+		ts2->gen_ctrl_val  = 0x0c; /* Serial bus + punctured clock*/
+		ts2->ts_clk_en_val = 0x1;  /* Enable TS_CLK */
+		ts2->src_sel_val   = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;
+		break;
 	case CX23885_BOARD_TEVII_S470:
 	case CX23885_BOARD_DVBWORLD_2005:
 		ts1->gen_ctrl_val  = 0x5; /* Parallel */
@@ -1415,6 +1474,10 @@
 	case CX23885_BOARD_HAUPPAUGE_HVR1290:
 	case CX23885_BOARD_LEADTEK_WINFAST_PXTV1200:
 	case CX23885_BOARD_GOTVIEW_X5_3D_HYBRID:
+	case CX23885_BOARD_TBS_6920:
+	case CX23885_BOARD_TBS_6921:
+	case CX23885_BOARD_TBS_6980:
+	case CX23885_BOARD_TBS_6981:
 		dev->sd_cx25840 = v4l2_i2c_new_subdev(&dev->v4l2_dev,
 				&dev->i2c_bus[2].i2c_adap,
 				"cx25840", 0x88 >> 1, NULL);
diff -uNr ../linux-3.1-rc9/drivers/media/video/cx23885/cx23885-core.c linux-3.1-rc9//drivers/media/video/cx23885/cx23885-core.c
--- ../linux-3.1-rc9/drivers/media/video/cx23885/cx23885-core.c	2011-10-05 01:11:50.000000000 +0000
+++ linux-3.1-rc9//drivers/media/video/cx23885/cx23885-core.c	2011-10-15 12:00:27.887901930 +0000
@@ -924,7 +924,7 @@
 	dev->i2c_bus[1].reg_addr  = I2C2_ADDR;
 	dev->i2c_bus[1].reg_rdata = I2C2_RDATA;
 	dev->i2c_bus[1].reg_wdata = I2C2_WDATA;
-	dev->i2c_bus[1].i2c_period = (0x9d << 24); /* 100kHz */
+	dev->i2c_bus[1].i2c_period = (0x27 << 24);
 
 	/* Internal Master 3 Bus */
 	dev->i2c_bus[2].nr = 2;
diff -uNr ../linux-3.1-rc9/drivers/media/video/cx23885/cx23885-dvb.c linux-3.1-rc9//drivers/media/video/cx23885/cx23885-dvb.c
--- ../linux-3.1-rc9/drivers/media/video/cx23885/cx23885-dvb.c	2011-10-05 01:11:50.000000000 +0000
+++ linux-3.1-rc9//drivers/media/video/cx23885/cx23885-dvb.c	2011-10-16 14:40:47.000000000 +0000
@@ -61,6 +61,10 @@
 #include "cx23885-f300.h"
 #include "altera-ci.h"
 #include "stv0367.h"
+#include "tbs6980fe.h"
+#include "tbs6981fe.h"
+#include "tbs6921fe.h"
+#include "tbsfe.h"
 
 static unsigned int debug;
 
@@ -127,6 +131,18 @@
 		fe->dvb.frontend->ops.i2c_gate_ctrl(fe->dvb.frontend, open);
 }
 
+int cx23885ctrl1(struct cx23885_dev *dev, int a)
+{
+	return cx_read(a);
+}
+
+int cx23885ctrl2(struct cx23885_dev *dev, int a, int b)
+{
+	cx_write(a, b);
+
+	return 0;
+}
+
 static struct videobuf_queue_ops dvb_qops = {
 	.buf_setup    = dvb_buf_setup,
 	.buf_prepare  = dvb_buf_prepare,
@@ -452,6 +468,27 @@
 	.demod_address = 0x55,
 };
 
+static struct tbs6980fe_config tbs6980_fe_config = {
+	.tbs6980fe_address = 0x55,
+
+	.tbs6980_ctrl1 = cx23885ctrl1,
+	.tbs6980_ctrl2 = cx23885ctrl2,
+};
+
+static struct tbs6981fe_config tbs6981_fe_config = {
+	.tbs6981fe_address = 0x55,
+
+	.tbs6981_ctrl1 = cx23885ctrl1,
+	.tbs6981_ctrl2 = cx23885ctrl2,
+};
+
+static struct tbs6921fe_config tbs6921_fe_config = {
+	.tbs6921fe_address = 0x55,
+
+	.tbs6921_ctrl1 = cx23885ctrl1,
+	.tbs6921_ctrl2 = cx23885ctrl2,
+};
+
 static struct ds3000_config tevii_ds3000_config = {
 	.demod_address = 0x68,
 };
@@ -844,7 +881,7 @@
 			static struct xc2028_ctrl ctl = {
 				.fname   = XC3028L_DEFAULT_FIRMWARE,
 				.max_len = 64,
-				.demod   = 5000,
+				.demod   = XC3028_FE_DIBCOM52,
 				/* This is true for all demods with
 					v36 firmware? */
 				.type    = XC2028_D2633,
@@ -929,7 +966,6 @@
 					       &dvico_fusionhdtv_xc3028,
 					       &i2c_bus->i2c_adap);
 		if (fe0->dvb.frontend != NULL) {
-			struct dvb_frontend	*fe;
 			struct xc4000_config	cfg = {
 				.i2c_address	  = 0x61,
 				.default_pm	  = 0,
@@ -938,7 +974,7 @@
 				.if_khz		  = 4560
 			};
 
-			fe = dvb_attach(xc4000_attach, fe0->dvb.frontend,
+			dvb_attach(xc4000_attach, fe0->dvb.frontend,
 					&dev->i2c_bus[1].i2c_adap, &cfg);
 		}
 		break;
@@ -952,6 +988,52 @@
 			fe0->dvb.frontend->ops.set_voltage = f300_set_voltage;
 
 		break;
+	case CX23885_BOARD_TBS_6921:
+		i2c_bus = &dev->i2c_bus[1];
+
+		fe0->dvb.frontend = dvb_attach(tbs6921fe_attach,
+					&tbs6921_fe_config,
+					&i2c_bus->i2c_adap, 0);
+		dvb_attach(tbsfe_attach, fe0->dvb.frontend);
+		break;
+	case CX23885_BOARD_TBS_6980:
+		i2c_bus = &dev->i2c_bus[1];
+
+		switch (port->nr) {
+		case 1:
+			fe0->dvb.frontend = dvb_attach(tbs6980fe_attach,
+				&tbs6980_fe_config,
+				&i2c_bus->i2c_adap, 0);
+			dvb_attach(tbsfe_attach, fe0->dvb.frontend);
+		break;
+		case 2:
+			fe0->dvb.frontend = dvb_attach(tbs6980fe_attach,
+				&tbs6980_fe_config,
+				&i2c_bus->i2c_adap, 1);
+			dvb_attach(tbsfe_attach, fe0->dvb.frontend);
+		break;
+		}
+
+		break;
+	case CX23885_BOARD_TBS_6981:
+		i2c_bus = &dev->i2c_bus[1];
+
+		switch (port->nr) {
+		case 1:
+			fe0->dvb.frontend = dvb_attach(tbs6981fe_attach,
+				&tbs6981_fe_config,
+				&i2c_bus->i2c_adap, 0);
+			dvb_attach(tbsfe_attach, fe0->dvb.frontend);
+		break;
+		case 2:
+			fe0->dvb.frontend = dvb_attach(tbs6981fe_attach,
+				&tbs6981_fe_config,
+				&i2c_bus->i2c_adap, 1);
+			dvb_attach(tbsfe_attach, fe0->dvb.frontend);
+		break;
+		}
+
+		break;
 	case CX23885_BOARD_TEVII_S470:
 		i2c_bus = &dev->i2c_bus[1];
 
@@ -1193,6 +1275,39 @@
 		memcpy(port->frontends.adapter.proposed_mac, eeprom + 0xa0, 6);
 		break;
 		}
+	case CX23885_BOARD_TBS_6920: 
+	case CX23885_BOARD_TBS_6921: {
+		u8 eeprom[256]; /* 24C02 i2c eeprom */
+
+		cx23885_tbs(dev);
+
+		if (port->nr != 1)
+			break;
+
+		/* Read entire EEPROM */
+		dev->i2c_bus[0].i2c_client.addr = 0xa0 >> 1;
+		tveeprom_read(&dev->i2c_bus[0].i2c_client, eeprom, sizeof(eeprom));
+		printk(KERN_INFO "TurboSight TBS 692x MAC= "
+				"%02X:%02X:%02X:%02X:%02X:%02X\n",
+				eeprom[0xa0], eeprom[0xa1], eeprom[0xa2],
+				eeprom[0xa3], eeprom[0xa4], eeprom[0xa5]);
+		memcpy(port->frontends.adapter.proposed_mac, eeprom + 0xa0, 6);
+		break;
+		}
+	case CX23885_BOARD_TBS_6980: 
+	case CX23885_BOARD_TBS_6981: {
+		u8 eeprom[256]; /* 24C02 i2c eeprom */
+
+		cx23885_tbs(dev);
+
+		/* Read entire EEPROM */
+		dev->i2c_bus[0].i2c_client.addr = 0xa0 >> 1;
+		tveeprom_read(&dev->i2c_bus[0].i2c_client, eeprom, sizeof(eeprom));
+		memcpy(port->frontends.adapter.proposed_mac, eeprom + 0xa0 + 16*(port->nr - 1), 6);
+		printk(KERN_INFO "TurboSight TBS698x Dual DVB-S2 card port%d MAC=%pM\n",
+			(port->nr - 1), port->frontends.adapter.proposed_mac);
+		break;
+		}
 	}
 
 	return ret;
diff -uNr ../linux-3.1-rc9/drivers/media/video/cx23885/cx23885-f300.c linux-3.1-rc9//drivers/media/video/cx23885/cx23885-f300.c
--- ../linux-3.1-rc9/drivers/media/video/cx23885/cx23885-f300.c	2011-10-05 01:11:50.000000000 +0000
+++ linux-3.1-rc9//drivers/media/video/cx23885/cx23885-f300.c	2011-10-09 15:00:14.000000000 +0000
@@ -149,6 +149,9 @@
 
 int f300_set_voltage(struct dvb_frontend *fe, fe_sec_voltage_t voltage)
 {
+	struct cx23885_tsport *port = fe->dvb->priv;
+	struct cx23885_dev *dev = port->dev;
+	
 	u8 buf[16];
 
 	buf[0] = 0x05;
@@ -160,16 +163,21 @@
 		buf[3] = 0x01;/* power on */
 		buf[4] = 0x02;/* B port, H/V */
 		buf[5] = 0x00;/*13V v*/
+		cx_set(MC417_RWD, 0x00000200);
+		cx_clear(MC417_RWD, 0x00000400);
 		break;
 	case SEC_VOLTAGE_18:
 		buf[3] = 0x01;
 		buf[4] = 0x02;
 		buf[5] = 0x01;/* 18V h*/
+		cx_set(MC417_RWD, 0x00000200);
+		cx_set(MC417_RWD, 0x00000400);
 		break;
 	case SEC_VOLTAGE_OFF:
 		buf[3] = 0x00;/* power off */
 		buf[4] = 0x00;
 		buf[5] = 0x00;
+		cx_clear(MC417_RWD, 0x00000200);
 		break;
 	}
 
diff -uNr ../linux-3.1-rc9/drivers/media/video/cx23885/cx23885-i2c.c linux-3.1-rc9//drivers/media/video/cx23885/cx23885-i2c.c
--- ../linux-3.1-rc9/drivers/media/video/cx23885/cx23885-i2c.c	2011-10-05 01:11:50.000000000 +0000
+++ linux-3.1-rc9//drivers/media/video/cx23885/cx23885-i2c.c	2011-10-17 16:49:00.869729767 +0000
@@ -392,6 +392,27 @@
 	i2c_xfer(&dev->i2c_bus[2].i2c_adap, &msg, 1);
 }
 
+void cx23885_tbs(struct cx23885_dev *dev)
+{
+	char buffer[2];
+	struct i2c_msg msg;
+
+	msg.addr = 0x4c;
+	msg.flags = I2C_M_TEN;
+	msg.len = 2;
+	msg.buf = buffer;
+
+	buffer[0] = 0x1f;
+	buffer[1] = 0x80;
+
+	i2c_xfer(&dev->i2c_bus[2].i2c_adap, &msg, 1);
+
+	buffer[0] = 0x23;
+	buffer[1] = 0x80;
+
+	i2c_xfer(&dev->i2c_bus[2].i2c_adap, &msg, 1);
+}
+
 /* ----------------------------------------------------------------------- */
 
 /*
diff -uNr ../linux-3.1-rc9/drivers/media/video/cx23885/cx23885-input.c linux-3.1-rc9//drivers/media/video/cx23885/cx23885-input.c
--- ../linux-3.1-rc9/drivers/media/video/cx23885/cx23885-input.c	2011-10-05 01:11:50.000000000 +0000
+++ linux-3.1-rc9//drivers/media/video/cx23885/cx23885-input.c	2011-10-17 16:49:00.870729755 +0000
@@ -87,6 +87,10 @@
 	case CX23885_BOARD_HAUPPAUGE_HVR1290:
 	case CX23885_BOARD_TEVII_S470:
 	case CX23885_BOARD_HAUPPAUGE_HVR1250:
+	case CX23885_BOARD_TBS_6920:
+	case CX23885_BOARD_TBS_6921:
+	case CX23885_BOARD_TBS_6980:
+	case CX23885_BOARD_TBS_6981:
 		/*
 		 * The only boards we handle right now.  However other boards
 		 * using the CX2388x integrated IR controller should be similar
@@ -163,6 +167,10 @@
 		params.invert_level = true;
 		break;
 	case CX23885_BOARD_TEVII_S470:
+	case CX23885_BOARD_TBS_6920:
+	case CX23885_BOARD_TBS_6921:
+	case CX23885_BOARD_TBS_6980:
+	case CX23885_BOARD_TBS_6981:
 		/*
 		 * The IR controller on this board only returns pulse widths.
 		 * Any other mode setting will fail to set up the device.
@@ -279,6 +287,16 @@
 		/* A guess at the remote */
 		rc_map = RC_MAP_TEVII_NEC;
 		break;
+	case CX23885_BOARD_TBS_6920:
+	case CX23885_BOARD_TBS_6921:
+	case CX23885_BOARD_TBS_6980:
+	case CX23885_BOARD_TBS_6981:
+		/* Integrated CX23885 IR controller */
+		driver_type = RC_DRIVER_IR_RAW;
+		allowed_protos = RC_TYPE_ALL;
+		/* A guess at the remote */
+		rc_map = RC_MAP_TBS_NEC;
+		break;
 	default:
 		return -ENODEV;
 	}
diff -uNr ../linux-3.1-rc9/drivers/media/video/cx23885/cx23885.h linux-3.1-rc9//drivers/media/video/cx23885/cx23885.h
--- ../linux-3.1-rc9/drivers/media/video/cx23885/cx23885.h	2011-10-05 01:11:50.000000000 +0000
+++ linux-3.1-rc9//drivers/media/video/cx23885/cx23885.h	2011-10-17 16:49:00.871729743 +0000
@@ -19,6 +19,9 @@
  *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
  */
 
+#ifndef CX23885_H
+#define CX23885_H
+
 #include <linux/pci.h>
 #include <linux/i2c.h>
 #include <linux/i2c-algo-bit.h>
@@ -42,7 +45,7 @@
 
 #define UNSET (-1U)
 
-#define CX23885_MAXBOARDS 8
+#define CX23885_MAXBOARDS 32
 
 /* Max number of inputs by card */
 #define MAX_CX23885_INPUT 8
@@ -86,6 +89,9 @@
 #define CX23885_BOARD_GOTVIEW_X5_3D_HYBRID     29
 #define CX23885_BOARD_NETUP_DUAL_DVB_T_C_CI_RF 30
 #define CX23885_BOARD_LEADTEK_WINFAST_PXDVR3200_H_XC4000 31
+#define CX23885_BOARD_TBS_6980                 32
+#define CX23885_BOARD_TBS_6981                 33
+#define CX23885_BOARD_TBS_6921                 34
 
 #define GPIO_0 0x00000001
 #define GPIO_1 0x00000002
@@ -545,6 +551,7 @@
 extern int cx23885_i2c_register(struct cx23885_i2c *bus);
 extern int cx23885_i2c_unregister(struct cx23885_i2c *bus);
 extern void cx23885_av_clk(struct cx23885_dev *dev, int enable);
+extern void cx23885_tbs(struct cx23885_dev *dev);
 
 /* ----------------------------------------------------------- */
 /* cx23885-417.c                                               */
@@ -581,3 +588,5 @@
 {
 	return (norm & (V4L2_STD_MN & ~V4L2_STD_PAL_Nc)) ? 754 : 922;
 }
+
+#endif
diff -uNr ../linux-3.1-rc9/drivers/media/video/cx23885/tbs5921fe.h linux-3.1-rc9//drivers/media/video/cx23885/tbs5921fe.h
--- ../linux-3.1-rc9/drivers/media/video/cx23885/tbs5921fe.h	1970-01-01 00:00:00.000000000 +0000
+++ linux-3.1-rc9//drivers/media/video/cx23885/tbs5921fe.h	2011-10-17 16:49:00.872729731 +0000
@@ -0,0 +1,35 @@
+/*
+    TurboSight TBS 5921 DVBS/S2 frontend driver
+    Copyright (C) 2010 Konstantin Dimitrov <kosio.dimitrov@gmail.com>
+
+    Copyright (C) 2010 TurboSight.com
+*/
+
+#ifndef TBS5921FE_H
+#define TBS5921FE_H
+
+#include <linux/dvb/frontend.h>
+#include "dvb-usb.h"
+
+struct tbs5921fe_config {
+	u8 tbs5921fe_address;
+
+	int (*tbs5921_ctrl)(struct usb_device *dev, u8 *a);
+};
+
+#if defined(CONFIG_DVB_TBS5921FE) || \
+	(defined(CONFIG_DVB_TBS5921FE_MODULE) && defined(MODULE))
+extern struct dvb_frontend *tbs5921fe_attach(
+	const struct tbs5921fe_config *config,
+	struct i2c_adapter *i2c, int demod);
+#else
+static inline struct dvb_frontend *tbs5921fe_attach(
+	const struct tbs5921fe_config *config,
+	struct i2c_adapter *i2c, int demod)
+{
+	printk(KERN_WARNING "%s: driver disabled by Kconfig\n", __func__);
+	return NULL;
+}
+#endif
+
+#endif /* TBS5921FE_H */
diff -uNr ../linux-3.1-rc9/drivers/media/video/cx23885/tbs5922fe.h linux-3.1-rc9//drivers/media/video/cx23885/tbs5922fe.h
--- ../linux-3.1-rc9/drivers/media/video/cx23885/tbs5922fe.h	1970-01-01 00:00:00.000000000 +0000
+++ linux-3.1-rc9//drivers/media/video/cx23885/tbs5922fe.h	2011-10-17 16:49:00.872729731 +0000
@@ -0,0 +1,35 @@
+/*
+    TurboSight TBS 5922 DVBS/S2 frontend driver
+    Copyright (C) 2011 Konstantin Dimitrov <kosio.dimitrov@gmail.com>
+
+    Copyright (C) 2011 TurboSight.com
+*/
+
+#ifndef TBS5922FE_H
+#define TBS5922FE_H
+
+#include <linux/dvb/frontend.h>
+#include "dvb-usb.h"
+
+struct tbs5922fe_config {
+	u8 tbs5922fe_address;
+
+	int (*tbs5922_ctrl)(struct usb_device *dev, u8 *a);
+};
+
+#if defined(CONFIG_DVB_TBS5922FE) || \
+	(defined(CONFIG_DVB_TBS5922FE_MODULE) && defined(MODULE))
+extern struct dvb_frontend *tbs5922fe_attach(
+	const struct tbs5922fe_config *config,
+	struct i2c_adapter *i2c);
+#else
+static inline struct dvb_frontend *tbs5922fe_attach(
+	const struct tbs5922fe_config *config,
+	struct i2c_adapter *i2c)
+{
+	printk(KERN_WARNING "%s: driver disabled by Kconfig\n", __func__);
+	return NULL;
+}
+#endif
+
+#endif /* TBS5922FE_H */
diff -uNr ../linux-3.1-rc9/drivers/media/video/cx23885/tbs62x0fe.h linux-3.1-rc9//drivers/media/video/cx23885/tbs62x0fe.h
--- ../linux-3.1-rc9/drivers/media/video/cx23885/tbs62x0fe.h	1970-01-01 00:00:00.000000000 +0000
+++ linux-3.1-rc9//drivers/media/video/cx23885/tbs62x0fe.h	2011-10-17 16:49:00.873729719 +0000
@@ -0,0 +1,36 @@
+/*
+    TurboSight TBS 62x0 DVBT/T2/C frontend driver
+    Copyright (C) 2011 Konstantin Dimitrov <kosio.dimitrov@gmail.com>
+
+    Copyright (C) 2011 TurboSight.com
+*/
+
+#ifndef TBS62X0FE_H
+#define TBS62X0FE_H
+
+#include <linux/dvb/frontend.h>
+#include "saa716x_priv.h"
+
+struct tbs62x0fe_config {
+	u8 tbs62x0fe_address;
+
+	int (*tbs62x0_ctrl1)(struct saa716x_dev *dev, int a);
+	int (*tbs62x0_ctrl2)(struct saa716x_dev *dev, int a, int b);
+};
+
+#if defined(CONFIG_DVB_TBS62X0FE) || \
+	(defined(CONFIG_DVB_TBS62X0FE_MODULE) && defined(MODULE))
+extern struct dvb_frontend *tbs62x0fe_attach(
+	const struct tbs62x0fe_config *config,
+	struct i2c_adapter *i2c);
+#else
+static inline struct dvb_frontend *tbs62x0fe_attach(
+	const struct tbs62x0fe_config *config,
+	struct i2c_adapter *i2c)
+{
+	printk(KERN_WARNING "%s: driver disabled by Kconfig\n", __func__);
+	return NULL;
+}
+#endif
+
+#endif /* TBS62X0FE_H */
diff -uNr ../linux-3.1-rc9/drivers/media/video/cx23885/tbs6921fe.h linux-3.1-rc9//drivers/media/video/cx23885/tbs6921fe.h
--- ../linux-3.1-rc9/drivers/media/video/cx23885/tbs6921fe.h	1970-01-01 00:00:00.000000000 +0000
+++ linux-3.1-rc9//drivers/media/video/cx23885/tbs6921fe.h	2011-10-17 16:49:00.874729706 +0000
@@ -0,0 +1,36 @@
+/*
+    TurboSight TBS 6921 DVBS/S2 frontend driver
+    Copyright (C) 2010 Konstantin Dimitrov <kosio.dimitrov@gmail.com>
+
+    Copyright (C) 2010 TurboSight.com
+*/
+
+#ifndef TBS6921FE_H
+#define TBS6921FE_H
+
+#include <linux/dvb/frontend.h>
+#include "cx23885.h"
+
+struct tbs6921fe_config {
+	u8 tbs6921fe_address;
+
+	int (*tbs6921_ctrl1)(struct cx23885_dev *dev, int a);
+	int (*tbs6921_ctrl2)(struct cx23885_dev *dev, int a, int b);
+};
+
+#if defined(CONFIG_DVB_TBS6921FE) || \
+	(defined(CONFIG_DVB_TBS6921FE_MODULE) && defined(MODULE))
+extern struct dvb_frontend *tbs6921fe_attach(
+	const struct tbs6921fe_config *config,
+	struct i2c_adapter *i2c, int demod);
+#else
+static inline struct dvb_frontend *tbs6921fe_attach(
+	const struct tbs6921fe_config *config,
+	struct i2c_adapter *i2c, int demod)
+{
+	printk(KERN_WARNING "%s: driver disabled by Kconfig\n", __func__);
+	return NULL;
+}
+#endif
+
+#endif /* TBS6921FE_H */
diff -uNr ../linux-3.1-rc9/drivers/media/video/cx23885/tbs6980fe.h linux-3.1-rc9//drivers/media/video/cx23885/tbs6980fe.h
--- ../linux-3.1-rc9/drivers/media/video/cx23885/tbs6980fe.h	1970-01-01 00:00:00.000000000 +0000
+++ linux-3.1-rc9//drivers/media/video/cx23885/tbs6980fe.h	2011-10-17 16:49:00.875729693 +0000
@@ -0,0 +1,36 @@
+/*
+    TurboSight TBS 6980 Dual DVBS/S2 frontend driver
+    Copyright (C) 2009 Konstantin Dimitrov <kosio.dimitrov@gmail.com>
+
+    Copyright (C) 2009 TurboSight.com
+*/
+
+#ifndef TBS6980FE_H
+#define TBS6980FE_H
+
+#include <linux/dvb/frontend.h>
+#include "cx23885.h"
+
+struct tbs6980fe_config {
+	u8 tbs6980fe_address;
+
+	int (*tbs6980_ctrl1)(struct cx23885_dev *dev, int a);
+	int (*tbs6980_ctrl2)(struct cx23885_dev *dev, int a, int b);
+};
+
+#if defined(CONFIG_DVB_TBS6980FE) || \
+	(defined(CONFIG_DVB_TBS6980FE_MODULE) && defined(MODULE))
+extern struct dvb_frontend *tbs6980fe_attach(
+	const struct tbs6980fe_config *config,
+	struct i2c_adapter *i2c, int demod);
+#else
+static inline struct dvb_frontend *tbs6980fe_attach(
+	const struct tbs6980fe_config *config,
+	struct i2c_adapter *i2c, int demod)
+{
+	printk(KERN_WARNING "%s: driver disabled by Kconfig\n", __func__);
+	return NULL;
+}
+#endif
+
+#endif /* TBS6980FE_H */
diff -uNr ../linux-3.1-rc9/drivers/media/video/cx23885/tbs6981fe.h linux-3.1-rc9//drivers/media/video/cx23885/tbs6981fe.h
--- ../linux-3.1-rc9/drivers/media/video/cx23885/tbs6981fe.h	1970-01-01 00:00:00.000000000 +0000
+++ linux-3.1-rc9//drivers/media/video/cx23885/tbs6981fe.h	2011-10-17 16:49:00.876729680 +0000
@@ -0,0 +1,36 @@
+/*
+    TurboSight TBS 6981 Dual DVBS/S2 frontend driver
+    Copyright (C) 2009 Konstantin Dimitrov <kosio.dimitrov@gmail.com>
+
+    Copyright (C) 2009 TurboSight.com
+*/
+
+#ifndef TBS6981FE_H
+#define TBS6981FE_H
+
+#include <linux/dvb/frontend.h>
+#include "cx23885.h"
+
+struct tbs6981fe_config {
+	u8 tbs6981fe_address;
+
+	int (*tbs6981_ctrl1)(struct cx23885_dev *dev, int a);
+	int (*tbs6981_ctrl2)(struct cx23885_dev *dev, int a, int b);
+};
+
+#if defined(CONFIG_DVB_TBS6981FE) || \
+	(defined(CONFIG_DVB_TBS6981FE_MODULE) && defined(MODULE))
+extern struct dvb_frontend *tbs6981fe_attach(
+	const struct tbs6981fe_config *config,
+	struct i2c_adapter *i2c, int demod);
+#else
+static inline struct dvb_frontend *tbs6981fe_attach(
+	const struct tbs6981fe_config *config,
+	struct i2c_adapter *i2c, int demod)
+{
+	printk(KERN_WARNING "%s: driver disabled by Kconfig\n", __func__);
+	return NULL;
+}
+#endif
+
+#endif /* TBS6981FE_H */
diff -uNr ../linux-3.1-rc9/drivers/media/video/cx23885/tbs6984fe.h linux-3.1-rc9//drivers/media/video/cx23885/tbs6984fe.h
--- ../linux-3.1-rc9/drivers/media/video/cx23885/tbs6984fe.h	1970-01-01 00:00:00.000000000 +0000
+++ linux-3.1-rc9//drivers/media/video/cx23885/tbs6984fe.h	2011-10-17 16:49:00.877729667 +0000
@@ -0,0 +1,36 @@
+/*
+    TurboSight TBS 6984 Dual DVBS/S2 frontend driver
+    Copyright (C) 2010 Konstantin Dimitrov <kosio.dimitrov@gmail.com>
+
+    Copyright (C) 2010 TurboSight.com
+*/
+
+#ifndef TBS6984FE_H
+#define TBS6984FE_H
+
+#include <linux/dvb/frontend.h>
+#include "saa716x_priv.h"
+
+struct tbs6984fe_config {
+	u8 tbs6984fe_address;
+
+	int (*tbs6984_ctrl1)(struct saa716x_dev *dev, int a);
+	int (*tbs6984_ctrl2)(struct saa716x_dev *dev, int a, int b);
+};
+
+#if defined(CONFIG_DVB_TBS6984FE) || \
+	(defined(CONFIG_DVB_TBS6984FE_MODULE) && defined(MODULE))
+extern struct dvb_frontend *tbs6984fe_attach(
+	const struct tbs6984fe_config *config,
+	struct i2c_adapter *i2c, int demod);
+#else
+static inline struct dvb_frontend *tbs6984fe_attach(
+	const struct tbs6984fe_config *config,
+	struct i2c_adapter *i2c, int demod)
+{
+	printk(KERN_WARNING "%s: driver disabled by Kconfig\n", __func__);
+	return NULL;
+}
+#endif
+
+#endif /* TBS6984FE_H */
